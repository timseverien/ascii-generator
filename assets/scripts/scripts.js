!function e(t,n,r){function a(o,u){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!u&&l)return l(o,!0);if(i)return i(o,!0);var s=new Error("Cannot find module '"+o+"'");throw s.code="MODULE_NOT_FOUND",s}var c=n[o]={exports:{}};t[o][0].call(c.exports,function(e){var n=t[o][1][e];return a(n?n:e)},c,c.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)a(r[o]);return a}({1:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./factories/AsciiFactory"),u=r(o),l=e("./factories/CharacterSetFactory"),s=r(l),c=e("./factories/ImageFactory"),h=r(c),f=e("./services/CanvasService"),g=r(f),d=function(){function e(t){var n=this;a(this,e),this.imageFile=void 0,this.inputFileElement=t.inputFileElement,this.inputFilePreviewElement=t.inputFilePreviewElement,this.inputCharacterSetElement=t.inputCharacterSetElement,this.inputSizeElement=t.inputSizeElement,this.inputLineHeightElement=t.inputLineHeightElement,this.characterSetRangeElement=t.characterSetRangeElement,this.btnPreset=t.btnPreset,this.btnStartElement=t.btnStartElement,this.outputElement=t.outputElement,this.addInputEventListeners(),this.setCharacterSetFromPreset(this.getPresets().ascii),this.btnStartElement.addEventListener("click",function(){n.isValid()&&n.generateAscii(n.imageFile).then(function(e){n.outputElement.innerHTML=n.escapeHtml(e)})})}return i(e,[{key:"addInputEventListeners",value:function(){var t=this,n=function(e){t.inputFileElement.parentNode.classList.remove("form__control--error"),h["default"].getImageFromFile(e).then(function(n){t.inputFilePreviewElement.style.backgroundImage="url("+n.src+")",t.inputFilePreviewElement.parentNode.classList.add("file-uploader--preview"),t.imageFile=e})["catch"](function(e){t.imageFile=void 0})};this.inputFileElement.addEventListener("change",function(){t.inputFileElement.files.length&&n(t.inputFileElement.files[0])}),this.inputFileElement.parentNode.addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault(),t.inputFileElement.parentNode.classList.add("file-uploader--highlight")}),this.inputFileElement.parentNode.addEventListener("dragleave",function(e){e.stopPropagation(),e.preventDefault(),t.inputFileElement.parentNode.classList.remove("file-uploader--highlight")}),this.inputFileElement.parentNode.addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault(),n(e.dataTransfer.files[0]),t.inputFileElement.parentNode.classList.remove("file-uploader--highlight")}),this.inputCharacterSetElement.addEventListener("change",function(){t.inputCharacterSetElement.classList.remove("form__control--error")}),this.inputCharacterSetElement.addEventListener("change",function(){t.inputCharacterSetElement.classList.remove("form__control--error")});var r=function(n){t.btnPreset[n].addEventListener("click",function(){var r=t.getPresets();t.setCharacterSetFromPreset(r[n]),t.inputLineHeightElement.value=e.LINE_HEIGHT[n]})};for(var a in this.btnPreset)r(a);this.inputCharacterSetElement.addEventListener("change",function(){return t.selectCharacterSet()}),this.inputCharacterSetElement.addEventListener("keyup",function(){return t.selectCharacterSet()})}},{key:"setCharacterSetFromPreset",value:function(e){this.inputCharacterSetElement.value=e.join(""),this.selectCharacterSet()}},{key:"getCharacterSet",value:function(){var e=[],t=!0,n=!1,r=void 0;try{for(var a,i=this.inputCharacterSetElement.value[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value;e.indexOf(o)>=0||e.push(o)}}catch(u){n=!0,r=u}finally{try{!t&&i["return"]&&i["return"]()}finally{if(n)throw r}}return e}},{key:"selectCharacterSet",value:function(){var t=this.getCharacterSet(),n=this.characterSetRangeElement,r=n.getContext("2d"),a={},i=0;this.characterLightnessSet=g["default"].normalizeCharacterLightness(g["default"].getCharacterLightnessSet(t,e.FONT_SIZE)),this.characterLightnessSet=this.characterLightnessSet.sort(function(e,t){return t.lightness-e.lightness}),this.characterLightnessSet.forEach(function(e){var n=Math.floor(e.lightness*t.length).toString();a[n]||(a[n]=0),a[n]++,i=Math.max(a[n],i)}),n.height=25,n.width=t.length,r.clearRect(0,0,n.width,n.height),r.strokeStyle="rgba(0, 0, 0, .5)";for(var o in a)r.moveTo(o,n.height),r.lineTo(o,n.height-a[o]/i*n.height);r.stroke()}},{key:"generateAscii",value:function(e){var t=this;return new Promise(function(n,r){h["default"].getImageFromFile(e).then(function(e){var r=t.inputSizeElement.value,a=r/e.width*e.height/t.inputLineHeightElement.value,i=g["default"].getCanvasFromImage(e,r,a),o=i.getContext("2d"),l=o.getImageData(0,0,i.width,i.height),s=g["default"].getImageLightnessData(l);if(s.data=g["default"].normalizeLightness(s.data),"Worker"in window){var c=new Worker("assets/scripts/ascii-factory.js");c.onmessage=function(e){return n(e.data)},c.postMessage({characterLightnessSet:t.characterLightnessSet,imageLightnessData:s})}else n(u["default"].getAscii(t.characterLightnessSet,s))})["catch"](function(e){console.error(e)})})}},{key:"getPresets",value:function(){return{ascii:s["default"].getCharacterSet(32,126),emoji:s["default"].getCharacterSet(128512,128591),latin:Array.prototype.concat(s["default"].getCharacterSet(32,126),s["default"].getCharacterSet(161,383))}}},{key:"escapeHtml",value:function(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}},{key:"isValid",value:function t(){var t=!0;return this.imageFile||(this.inputFileElement.parentNode.classList.add("form__control--error"),t=!1),this.inputCharacterSetElement.value||(this.inputCharacterSetElement.classList.add("form__control--error"),t=!1),(isNaN(parseInt(this.inputSizeElement.value))||this.inputSizeElement.value<2)&&(this.inputSizeElement.classList.add("form__control--error"),t=!1),isNaN(parseFloat(this.inputLineHeightElement.value))&&(this.inputLineHeightElement.classList.add("form__control--error"),t=!1),t}}]),e}();n["default"]=d,d.FONT_SIZE=12,d.LINE_HEIGHT={ascii:1.8,latin:1.8,emoji:1.2},window.App=d},{"./factories/AsciiFactory":2,"./factories/CharacterSetFactory":3,"./factories/ImageFactory":4,"./services/CanvasService":5}],2:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(){r(this,e)}return a(e,null,[{key:"getAscii",value:function(e,t){var n="",r=function(t){var n=void 0;return e.forEach(function(e){n&&Math.abs(t-e.lightness)>=Math.abs(t-n.lightness)||(n=e)}),n.character};return t.data.forEach(function(e,a){a>0&&a%t.width===0&&(n+="\r\n"),n+=r(e)}),n}}]),e}();n["default"]=i},{}],3:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(){r(this,e)}return a(e,null,[{key:"getCharacterSet",value:function(e,t){for(var n=[],r=e;t>=r;r++)n.push(String.fromCodePoint(r));return n}}]),e}();n["default"]=i},{}],4:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(){r(this,e)}return a(e,null,[{key:"getImageFromFile",value:function(e){var t=new FileReader,n=new Image;return new Promise(function(r,a){t.addEventListener("load",function(){n.src=t.result}),n.addEventListener("load",function(){r(n)}),t.addEventListener("error",a),n.addEventListener("error",a),t.readAsDataURL(e)})}}]),e}();n["default"]=i},{}],5:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(){r(this,e)}return a(e,null,[{key:"getCanvasFromImage",value:function(e,t,n){var r=document.createElement("canvas"),a=r.getContext("2d");return r.height=Math.round(n),r.width=Math.round(t),a.fillStyle="#fff",a.fillRect(0,0,r.width,r.height),a.drawImage(e,0,0,r.width,r.height),r}},{key:"getCharacterLightnessSet",value:function(t,n){var r=document.createElement("canvas"),a=r.getContext("2d"),i=[];return r.height=n,r.width=n,a.fontStyle=n+"px monospace",t.forEach(function(t){a.fillStyle="#fff",a.fillRect(0,0,r.width,r.height),a.fillStyle="#000",a.fillText(t,0,r.height);var n=a.getImageData(0,0,r.width,r.height);i.push({character:t,lightness:e.getCanvasLightness(n)})}),i.filter(function(e){return e.lightness>0||32===e.character})}},{key:"getImageLightnessData",value:function(t){var n=[];return e.forEachPixel(t,function(e,t,r,a){n.push((e+t+r)/3)}),{data:n,height:t.height,width:t.width}}},{key:"getCanvasLightness",value:function(t){var n=e.getImageLightnessData(t),r=function(e,t){return e+t};return n.data.reduce(r,0)/n.data.length}},{key:"forEachPixel",value:function(e,t){for(var n=e.data,r=0;r<n.length;r+=4)t(n[r],n[r+1],n[r+2],n[r+3],r)}},{key:"normalizeCharacterLightness",value:function(e){var t=1/0,n=-(1/0);return e.forEach(function(e){t=Math.min(e.lightness,t),n=Math.max(e.lightness,n)}),e.map(function(e){return e.lightness=(e.lightness-t)/(n-t),e})}},{key:"normalizeLightness",value:function(e){var t=1/0,n=-(1/0);return e.forEach(function(e){t=Math.min(e,t),n=Math.max(e,n)}),e.map(function(e){return(e-t)/(n-t)})}}]),e}();n["default"]=i},{}]},{},[1]);
//# sourceMappingURL=scripts.js.map
